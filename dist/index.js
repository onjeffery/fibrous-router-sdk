var t=require("starknet");const e=(t,e)=>`${t}?${Object.keys(e).map(t=>`${t}=${e[t]}`).join("&")}`,r=t=>{const e={};return null!=t&&(e["X-API-Key"]=t),e},o=t=>Number(t.replace("%","")),s=t=>String(Math.floor(1e6*Number(t.toFixed(4))));function n(e,r,n){const i=10**6,c=e=>{const r=t.uint256.bnToUint256(e);return[r.low,r.high]},a=[];let u=100;for(const t of e.route){const e=o(t.percent),r=e/u;u-=e;for(let e=0;e<t.swaps.length;e++){const n=t.swaps[e];let i=0==e?r:1,c=100;for(const t of n){const e=o(t.percent),r=e/c*i;c-=e,a.push([t.fromTokenAddress,t.toTokenAddress,s(r),String(t.protocol),t.poolAddress])}}}const p=BigInt(e.outputAmount)*BigInt((1-r)*i)/BigInt(i);return[String(a.length),...a.flat(),e.inputToken.address,e.outputToken.address,...c(e.inputAmount),...c(p),n]}exports.Protocols={mySwap:1,JediSwap:2,"10K Swap":3,SithSwap:4},exports.Router=class{constructor(t,e){this.DEFAULT_API_URL="https://api.fibrous.finance",this.ROUTER_ADDRESS="0x1b23ed400b210766111ba5b1e63e33922c6ba0c45e6ad56ce112e5f4c578e62",this.apiUrl=void 0,this.apiKey=void 0,t&&t.endsWith("/")&&(t=t.substring(0,t.length-1)),this.apiUrl=t??this.DEFAULT_API_URL,this.apiKey=e??null}getBestRoute(t,o,s,n){try{const i=this,c={amount:t,tokenInAddress:o,tokenOutAddress:s};for(const[t,e]of Object.entries(n??{}))"excludeProtocols"!=t?c[t]=e:c.excludeProtocols=e.join(",");const a=e(`${i.apiUrl}/route`,c);return Promise.resolve(fetch(a,{headers:r(i.apiKey)}).then(t=>t.json()))}catch(t){return Promise.reject(t)}}supportedTokens(){try{const t=this;return Promise.resolve(fetch(`${t.apiUrl}/tokens`,{headers:r(t.apiKey)}).then(t=>t.json())).then(function(t){return t.reduce((t,e)=>Object.assign(t,{[e.symbol]:e}),{})})}catch(t){return Promise.reject(t)}}supportedProtocols(){try{const t=this;return Promise.resolve(fetch(`${t.apiUrl}/protocols`,{headers:r(t.apiKey)}).then(t=>t.json())).then(function(t){return t.reduce((t,e,r)=>Object.assign(t,{[e]:r+1}),{})})}catch(t){return Promise.reject(t)}}buildTransaction(t,e,r){return{contractAddress:this.ROUTER_ADDRESS,entryPoint:"swap",call_data:n(t,e,r)}}},exports.buildHeaders=r,exports.buildRouteUrl=e,exports.buildSwapCalldata=n,exports.parsePercent=s,exports.trimPercent=o;
